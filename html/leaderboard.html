<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard</title>
  <script type="text/javascript" src="../js/leaderboard.js" defer></script>
  <!--<script type="text/javascript" src="../js/test-database.js"></script>-->
  <script type="text/javascript" src="../js/popup.js" defer></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Acme">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bebas Neue">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto Serif">
  <link rel="stylesheet" href="../css/leaderboard-style.css">
  <link rel="stylesheet" href="../css/main-style.css">
  <link rel="stylesheet" href="../css/popup-style.css">
  <script src="https://kit.fontawesome.com/dab72a6e8d.js" crossorigin="anonymous"></script>
</head>

<body>
  <div id="popupCont">
    <!--Family History Popup-->
    <div id="familyHistoryPopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/tree-branches.jpg);">
          <h1>Family History Class</h1>
        </div>
        <div class="scrollCont">
          <h3>Why do Family History?</h3>
          <p>Where did I come from? Have you ever wondered that? It's about so much more than just what country our
            ancestors migrated from. It's about who you are, who they were, and who your children and their children's
            children will become. Family history is so important in God's work of bringing families together. That is
            why
            we have started a family history class: to help unite all of God's family. Our class is on <b>Wednesdays at
              7:30
              at 1503 E Colorado Blvd, Pasadena, CA 91106</b></p>
          <p>If you have any questions, please reach out at [info]</p>
        </div>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>

    <!--Institute Popup-->
    <div id="institutePopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/bricks.jpg);">
          <h1>Institute</h1>
        </div>
        <div class="scrollCont">
          <h3>Why come to Institute?</h3>
          <p>The Church of Jesus Christ of Latter-day Saints has stated:</p>
          <p>"The institutes of religion program of The Church of Jesus Christ of Latter-day Saints provides religious
            education for young adults ages 18 to 30. With a worldwide enrollment of more than 350,000 students in
            almost 2,700 locations, there is an institute of religion near you. Institute provides an opportunity for
            students to strengthen their commitment to Jesus Christ and conduct a comprehensive study of the scriptures
            and words of modern-day prophets. Institute students may find guidance and direction from the Holy Ghost.
            This guidance can help them make important life decisions as students learn together and strengthen one
            another." (<a href="https://www.churchofjesuschrist.org/si/institute/about/faq/" target="_blank">More
              here</a>)</p>
          <p>Institute is at <b>7:30pm</b> at: <b>1130 E Wilson Ave, Glendale, CA 91206 on Tuesdays</b> and <b>1503 E
              Colorado Blvd, Pasadena, CA 91106 on Thursdays</b></p>
        </div>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>

    <!--Church Popup-->
    <div id="churchPopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/church.jpg);">
          <h1>Attend Church</h1>
        </div>
        <div class="scrollCont">
        </div>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>

    <!--Meet with missionaries Popup-->
    <div id="missionaryPopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/scriptures.jpg);">
          <h1>Meet with Missionaries</h1>
        </div>
        <div class="scrollCont">
          <h3>Who are missionaries?</h3>
          <p>Missionaries are volunteers for the Church. Full-time missionaries devote all of their time, talents, and
            energy to their purpose of inviting others to come unto Christ by helping them recieve the Restored Gospel
            though:</p>
          <ul>
            <li>Faith in Jesus Christ and his Atonement</li>
            <li>Repentance</li>
            <li>Baptism</li>
            <li>Recieving the Gift of the Holy Ghost</li>
            <li>Enduring to the End</li>
          </ul>
          <h3>Why should I meet with missionaries?</h3>
          <p>If you've ever had a question about the Gospel of Jesus Christ, missionaries would love to help answer.
            Missionaries serve all over the world, speaking hundreds of different languages and dialects. Missionaries
            love to answer questions like:</p>
          <ul>
            <li>Does God exist? Who is God?</li>
            <li>Does God know me and care about me? How can I feel His love? How can I feel closer to Him?</li>
            <li>What is the purpose of life?</li>
            <li>Why is life so hard sometimes? How can I find strength during hard times?</li>
            <li>How can I find peace in times of turmoil?</li>
            <li>How can I be happier?</li>
            <li>How can I be a better person?</li>
            <li>How can I feel God's forgiveness?</li>
            <li>What happens after I die?</li>
            <li>How can I contribute to the spiritual well-being of my family?</li>
            <li>How can I help my children build strength to resist temptation?</li>
            <li>How can obeying God's commandments help me have a happier, more abundant life?</li>
          </ul>
          <h3>How do I meet with missionaries?</h3>
          <p>You can reach out to missionaries via the <a
              href="https://www.churchofjesuschrist.org/comeuntochrist/lp/meet-with-missionaries/short">Church's
              Website</a>.
          </p>
        </div>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>
  </div>
  <div id="mainContentCont">
    <h1>Leaderboard!</h1>
    <div id="playerList">
      <!--<span>Hmm... seems like the leaderboard isn't working.<br>Try refreshing :\</span>-->

    </div>
    <!--Controls for the leaderboard-->
    <div id="leaderboardControlsCont">
      <div>
        <p id="nameInstruct">Create your name:</p>
        <select name="Name" id="nameDropdown">
          <option diabled selected value>Name</option>
          <option>Chede</option>
          <option>Adam</option>
          <option>Eve</option>
          <option>Noah</option>
          <option>Abraham</option>
          <option>Sarah</option>
          <option>Isaac</option>
          <option>Rebekah</option>
          <option>Jacob</option>
          <option>Joseph</option>
          <option>Moses</option>
          <option>Miriam</option>
          <option>Aaron</option>
          <option>Ruth</option>
          <option>David</option>
          <option>Solomon</option>
          <option>Elijah</option>
          <option>Esther</option>
          <option>Isaiah</option>
          <option>Mary</option>
          <option>John</option>
          <option>Peter</option>
          <option>Paul</option>
          <option>Andrew</option>
          <option>Philip</option>
          <option>Thomas</option>
          <option>Matthew</option>
          <option>Simon</option>
          <option>Thaddeus</option>
          <option>Bartholomew</option>
          <option>Matthias</option>
          <option>Timothy</option>
          <option>Titus</option>
          <option>Philemon</option>
          <option>Priscilla</option>
          <option>Aquila</option>
          <option>Lydia</option>
          <option>Phoebe</option>
        </select>
        <span>of</span>
        <select name="Place" id="placeDropdown">
          <option diabled selected value>Place</option>
          <option>Bethlehem</option>
          <option>Jerusalem</option>
          <option>Nazareth</option>
          <option>Capernaum</option>
          <option>Galilee</option>
          <option>Gethsemane</option>
          <option>Ephesus</option>
          <option>Corinth</option>
          <option>Thessalonica</option>
          <option>Antioch</option>
          <option>Jericho</option>
          <option>Canaan</option>
          <option>Samaria</option>
          <option>Damascus</option>
          <option>Shiloh</option>
          <option>Bethel</option>
          <option>Eden</option>
          <option>Sinai</option>
          <option>Jordan</option>
          <option>Tiberias</option>
          <option>Moriah</option>
          <option>Zion</option>
          <option>Hebron</option>
          <option>Joppa</option>
          <option>Ararat</option>
          <option>Nineveh</option>
          <option>Beersheba</option>
          <option>Bethany</option>
          <option>Bethsaida</option>
          <option>Dan</option>
          <option>Gerizim</option>
          <option>Mamre</option>
          <option>Shechem</option>
          <option>Tabgha</option>
          <option>Tarshish</option>
        </select>
      </div>
      <button id="submitButton">Submit score&nbsp;<i class="fa-solid fa-arrow-up"></i></button>
    </div>
    <button id="deleteDb">Clear data from DB</button>
    <a href="../index.html"><button>Go back</button></a>
    <!--This is for the YSA activities-->
    <div id="activitiesCont">
      <h2 class="activityHeading"><i class="fa-solid fa-arrow-down"></i>&nbsp;Click to learn more about&nbsp;<i
          class="fa-solid fa-arrow-down"></i></h2>
      <div id="activityRow">
        <div class="ysaActivity" id="familyHistory">Family History!</div>
        <div class="ysaActivity" id="institute">Institute!</div>
        <div class="ysaActivity" id="church">Church</div>
        <div class="ysaActivity" id="missionary">Meeting with Missionaries</div>
      </div>
    </div>
  </div>

  <!--Firebase Code!-->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import { doc, setDoc, getFirestore, getDoc, query, collection, getDocs, addDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyC4WuV4Pco4xOZ7TN4ZUZW7MyO40pph5Z4",
      authDomain: "bible-trivia-web.firebaseapp.com",
      projectId: "bible-trivia-web",
      storageBucket: "bible-trivia-web.appspot.com",
      messagingSenderId: "510142740882",
      appId: "1:510142740882:web:ec1ea5ddb63a8e7096694b",
      measurementId: "G-LTPMQ0JNXV"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    const db = getFirestore(app);

    document.getElementById('deleteDb').addEventListener('click', () => { clearDB() })

    /*const docRef = doc(db, 'players', '1XCdz2zONa5cLXoip2DA')*/

    var docSnap = await getDocs(query(collection(db, 'players')))

    try {
      document.getElementById('submitButton').addEventListener('click', () => { submitName() })
      var controls = document.getElementById('leaderboardControlsCont');
    }
    catch (TypeError) { /*I just wanted to make sure it didn't cause problems*/ }

    var dbData = []



    docSnap.forEach((doc) => {
      dbData.push(doc.data())
    });

    dbData.sort((a, b) => { return b.score - a.score })

    dbData.forEach((doc) => {
      renderLeaderboard(doc);
    })

    function renderLeaderboard(doc) {
      let playerDiv = document.createElement('div')

      playerDiv.setAttribute('class', 'player')

      if (controls != null) {
        if (doc.name == `${document.getElementById('nameDropdown').value} of ${document.getElementById('placeDropdown').value}`) playerDiv.setAttribute('id', 'newPlayer')
      }

      let name = document.createElement('span')
      name.textContent = `${doc.name}: ${doc.score}`
      playerDiv.appendChild(name)
      document.getElementById('playerList').appendChild(playerDiv)
    }

    async function submitName() {
      if (document.getElementById('nameDropdown').value == '' || document.getElementById('placeDropdown').value == '') return;
      let player = {
        name: `${document.getElementById('nameDropdown').value} of ${document.getElementById('placeDropdown').value}`,
        score: sessionStorage.getItem('score')
      }

      try {
        await setDoc(doc(db, 'players', player.name), player)
      }
      catch {
        console.log('It did not work...')
        let nameInstruct = document.getElementById('nameInstruct')
        nameInstruct.style.color = 'red'
        nameInstruct.innerHTML = 'Please choose another name'
        return;
      }

      while (document.getElementById('playerList').hasChildNodes()) {
        document.getElementById('playerList').removeChild(document.getElementById('playerList').firstChild)
      }

      docSnap = await getDocs(query(collection(db, 'players')))

      dbData = []
      docSnap.forEach((doc) => {
        dbData.push(doc.data())
      });

      dbData.sort((a, b) => { return b.score - a.score })

      dbData.forEach((doc) => {
        renderLeaderboard(doc);
      })
      sessionStorage.removeItem('score')
      document.getElementById('leaderboardControlsCont').remove()
      window.location.href = "#newPlayer"
    }

    async function clearDB() {
      docSnap.forEach(docToDelete => {
        deleteDoc(doc(db, 'players', docToDelete.id))
      });
    }

  </script>

  <!--<script src="../js/db-brain.js" defer></script>-->
</body>

</html>