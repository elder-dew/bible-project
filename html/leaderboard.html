<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard</title>
  <script type="text/javascript" src="../js/leaderboard.js" defer></script>
  <!--<script type="text/javascript" src="../js/test-database.js"></script>-->
  <script type="text/javascript" src="../js/popup.js" defer></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Acme">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bebas Neue">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto Serif">
  <link rel="stylesheet" href="../css/leaderboard-style.css">
  <link rel="stylesheet" href="../css/main-style.css">
  <link rel="stylesheet" href="../css/popup-style.css">
  <script src="https://kit.fontawesome.com/dab72a6e8d.js" crossorigin="anonymous"></script>
</head>

<body>
  <div id="popupCont">
    <!--Family History Popup-->
    <div id="familyHistoryPopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/tree-branches.jpg);">
          <h1>Family History Class</h1>
        </div>
        <h3>Why do Family History?</h3>
        <p>Where did I come from? Have you ever wondered that? It's about so much more than just what country our
          ancestors migrated from. It's about who you are, who they were, and who your children and their children's
          children will become. Family history is so important in God's work of bringing families together. That is why
          we have started a family history class: to help unite all of God's family. <b>Our class is on Wednesdays at
            7:30
            at 1503 E Colorado Blvd, Pasadena, CA 91106</b></p>
        <p>If you have any questions, please reach out at [info]</p>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>

    <!--Institute Popup-->
    <div id="institutePopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/scriptures.jpg);">
          <h1>Institute</h1>
        </div>
        <h3>Why come to Institute?</h3>
        <p>The Church of Jesus Christ of Latter-day Saints has stated:</p>
        <p>"The institutes of religion program of The Church of Jesus Christ of Latter-day Saints provides religious
          education for young adults ages 18 to 30. With a worldwide enrollment of more than 350,000 students in
          almost 2,700 locations, there is an institute of religion near you. Institute provides an opportunity for
          students to strengthen their commitment to Jesus Christ and conduct a comprehensive study of the scriptures
          and words of modern-day prophets. Institute students may find guidance and direction from the Holy Ghost.
          This guidance can help them make important life decisions as students learn together and strengthen one
          another." (<a href="https://www.churchofjesuschrist.org/si/institute/about/faq/" target="_blank">More here</a>)</p>
        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>

    <!--Church Popup-->
    <div id="churchPopup" class="popup">
      <div class="popupBody">
        <div class="header" style="background-image: url(../images/church.jpg);">
          <h1>Attend Church</h1>
        </div>

        <button onclick="ClosePopup(this.parentElement.parentElement)">Close</button>
      </div>
    </div>
  </div>
  <div id="mainContentCont">
    <h1>Leaderboard!</h1>
    <div id="playerList">
      <!--<span>Hmm... seems like the leaderboard isn't working.<br>Try refreshing :\</span>-->

    </div>
    <!--Controls for the leaderboard-->
    <div id="leaderboardControlsCont">
      <div>
        <select name="Name" id="nameDropdown">
          <option diabled selected value>Name</option>
          <option>Adam</option>
          <option>Eve</option>
          <option>Noah</option>
          <option>Abraham</option>
          <option>Sarah</option>
          <option>Isaac</option>
          <option>Rebekah</option>
          <option>Jacob</option>
          <option>Joseph</option>
          <option>Moses</option>
          <option>Miriam</option>
          <option>Aaron</option>
          <option>Ruth</option>
          <option>David</option>
          <option>Solomon</option>
          <option>Elijah</option>
          <option>Esther</option>
          <option>Isaiah</option>
          <option>Mary</option>
          <option>Joseph (husband of Mary)</option>
          <option>John</option>
          <option>Peter</option>
          <option>Paul</option>
          <option>James (son of Zebedee)</option>
          <option>James (son of Alphaeus)</option>
          <option>Andrew</option>
          <option>Philip</option>
          <option>Thomas</option>
          <option>Matthew</option>
          <option>Simon</option>
          <option>Thaddeus</option>
          <option>Bartholomew</option>
          <option>Matthias</option>
          <option>Timothy</option>
          <option>Titus</option>
          <option>Philemon</option>
          <option>Priscilla</option>
          <option>Aquila</option>
          <option>Lydia</option>
          <option>Phoebe</option>
        </select>
        <span>of</span>
        <select name="Place" id="placeDropdown">
          <option diabled selected value>Place</option>
          <option>Bethlehem</option>
          <option>Jerusalem</option>
          <option>Nazareth</option>
          <option>Capernaum</option>
          <option>Galilee</option>
          <option>Gethsemane</option>
          <option>Mount Sinai</option>
          <option>Mount Carmel</option>
          <option>Mount Horeb</option>
          <option>Mount Nebo</option>
          <option>Ephesus</option>
          <option>Corinth</option>
          <option>Thessalonica</option>
          <option>Antioch</option>
          <option>Babylon</option>
          <option>Jericho</option>
          <option>Canaan</option>
          <option>Samaria</option>
          <option>Damascus</option>
          <option>Shiloh</option>
          <option>Bethel</option>
          <option>Sodom</option>
          <option>Gomorrah</option>
          <option>Eden</option>
          <option>Sinai</option>
          <option>Jordan</option>
          <option>Tiberias</option>
          <option>Moriah</option>
          <option>Zion</option>
          <option>Hebron</option>
          <option>Mount of Olives</option>
          <option>Joppa</option>
          <option>Ararat</option>
          <option>Nineveh</option>
          <option>Beersheba</option>
          <option>Bethany</option>
          <option>Bethsaida</option>
          <option>Dan</option>
          <option>Gerizim</option>
          <option>Mamre</option>
          <option>Shechem</option>
          <option>Tabgha</option>
          <option>Tarshish</option>
        </select>
      </div>
      <button id="submitButton">Submit score&nbsp;<i class="fa-solid fa-arrow-up"></i></button>
      <button id="deleteDb">Clear data from DB</button>
    </div>
    <a href="./gameplay.html"><button>Go back</button></a>
    <!--This is for the YSA activities-->
    <div id="activitiesCont">
      <div class="ysaActivity" id="familyHistory">Family History!</div>
      <div class="ysaActivity" id="institute">Institute!</div>
      <div class="ysaActivity" id="church">Church</div>
    </div>
  </div>

  <!--Firebase Code!-->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import { doc, setDoc, getFirestore, getDoc, query, collection, getDocs, addDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyC4WuV4Pco4xOZ7TN4ZUZW7MyO40pph5Z4",
      authDomain: "bible-trivia-web.firebaseapp.com",
      projectId: "bible-trivia-web",
      storageBucket: "bible-trivia-web.appspot.com",
      messagingSenderId: "510142740882",
      appId: "1:510142740882:web:ec1ea5ddb63a8e7096694b",
      measurementId: "G-LTPMQ0JNXV"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    const db = getFirestore(app);

    document.getElementById('deleteDb').addEventListener('click', () => { clearDB() })

    /*const docRef = doc(db, 'players', '1XCdz2zONa5cLXoip2DA')*/

    var docSnap = await getDocs(query(collection(db, 'players')))

    try {
      document.getElementById('submitButton').addEventListener('click', () => { submitName() })
    }
    catch (TypeError) { /*I just wanted to make sure it didn't cause problems*/ }

    var dbData = []



    docSnap.forEach((doc) => {
      dbData.push(doc.data())
    });

    dbData.sort((a, b) => { return b.score - a.score })

    dbData.forEach((doc) => {
      renderLeaderboard(doc);
    })

    function renderLeaderboard(doc) {
      let playerDiv = document.createElement('div')

      playerDiv.setAttribute('class', 'player')
      if (doc.name == `${document.getElementById('nameDropdown').value} of ${document.getElementById('placeDropdown').value}`) playerDiv.setAttribute('id', 'newPlayer')

      let name = document.createElement('span')
      name.textContent = `${doc.name}: ${doc.score}`
      playerDiv.appendChild(name)
      document.getElementById('playerList').appendChild(playerDiv)
    }

    async function submitName() {
      if (document.getElementById('nameDropdown').value == '' || document.getElementById('placeDropdown').value == '') return;
      let player = {
        name: `${document.getElementById('nameDropdown').value} of ${document.getElementById('placeDropdown').value}`,
        score: sessionStorage.getItem('score')
      }

      addDoc(collection(db, 'players'), player)

      while (document.getElementById('playerList').hasChildNodes()) {
        document.getElementById('playerList').removeChild(document.getElementById('playerList').firstChild)
      }

      docSnap = await getDocs(query(collection(db, 'players')))
      dbData = []
      docSnap.forEach((doc) => {
        dbData.push(doc.data())
      });

      dbData.sort((a, b) => { return b.score - a.score })

      dbData.forEach((doc) => {
        renderLeaderboard(doc);
      })
      sessionStorage.removeItem('score')
      document.getElementById('submitButton').remove()
      window.location.href = "#newPlayer"
    }

    async function clearDB() {
      console.log('it worked')
      docSnap.forEach(docToDelete => {
        deleteDoc(doc(db, 'players', docToDelete.id))
      });
    }

  </script>

  <!--<script src="../js/db-brain.js" defer></script>-->
</body>

</html>